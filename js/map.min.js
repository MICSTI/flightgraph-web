d3.select(window).on("resize",throttle);var zoom=d3.behavior.zoom().scaleExtent([1,50]).on("zoom",move);var width=window.screen.width;var height=window.screen.height;var topo,projection,path,svg,g;var coordinates;var graticule=d3.geo.graticule();var tooltip=d3.select("#content").append("div").attr("class","tooltip hidden");var options={enableHighAccuracy:true,timeout:5000,maximumAge:0};navigator.geolocation.getCurrentPosition(success,error,options);setup(width,height);function setup(b,a){projection=d3.geo.mercator().translate([(b/2),(a/2)]).scale(b/2/Math.PI);path=d3.geo.path().projection(projection);svg=d3.select("#content").append("svg").attr("width",b).attr("height",a).call(zoom).on("click",click).append("g");g=svg.append("g")}d3.json("data/world-topo-min.json",function(b,c){var a=topojson.feature(c,c.objects.countries).features;topo=a;draw(topo)});function draw(b){svg.append("path").datum(graticule).attr("class","graticule").attr("d",path);g.append("path").datum({type:"LineString",coordinates:[[-180,0],[-90,0],[0,0],[90,0],[180,0]]}).attr("class","equator").attr("d",path);var d=g.selectAll(".country").data(b);d.enter().insert("path").attr("class","country").attr("d",path).attr("id",function(f,e){return f.id}).attr("title",function(f,e){return f.properties.name}).style("fill",function(f,e){return"#ECECEC"}).style("stroke",function(f,e){return"#000000"}).style("stroke-width",function(f,e){return 0.5});var a=document.getElementById("content").offsetLeft+20;var c=document.getElementById("content").offsetTop+10;d.on("mousemove",function(h,f){var e=d3.mouse(svg.node()).map(function(i){return parseInt(i)});tooltip.classed("hidden",false).attr("style","left:"+(e[0]+a)+"px;top:"+(e[1]+c)+"px").html(h.properties.name)}).on("mouseout",function(f,e){tooltip.classed("hidden",true)})}function redraw(){width=document.getElementById("content").offsetWidth;height=width/2;d3.select("svg").remove();setup(width,height);draw(topo)}function move(){var a=d3.event.translate;var c=d3.event.scale;zscale=c;var b=height/4;a[0]=Math.min((width/height)*(c-1),Math.max(width*(1-c),a[0]));a[1]=Math.min(b*(c-1)+b*c,Math.max(height*(1-c)-b*c,a[1]));zoom.translate(a);g.attr("transform","translate("+a+")scale("+c+")");d3.selectAll(".country").style("stroke-width",0.5/c)}var throttleTimer;function throttle(){window.clearTimeout(throttleTimer);throttleTimer=window.setTimeout(function(){redraw()},200)}function click(){var a=projection.invert(d3.mouse(this));console.log(a)}function addpoint(b,e,d){var c=g.append("g").attr("class","gpoint");var a=projection([b,e])[0];var f=projection([b,e])[1];c.append("svg:circle").attr("cx",a).attr("cy",f).attr("class","point").attr("r",1.5);if(d.length>0){c.append("text").attr("x",a+2).attr("y",f+2).attr("class","text").text(d)}}function success(a){coordinates=a.coords;console.log("Your current position is:");console.log("Latitude : "+coordinates.latitude);console.log("Longitude: "+coordinates.longitude)}function error(a){console.warn("ERROR("+a.code+"): "+a.message)};